#!/bin/bash

# Quick test guide for shielded fees

echo "üß™ Testing Noctura Shielded Mode - Fee Configuration"
echo "======================================================"
echo ""
echo "Prerequisites:"
echo "‚úì Wallet has at least 0.1 SOL and 1 NOC"
echo "‚úì App is running (npm run dev)"
echo "‚úì You are in shielded mode"
echo ""

echo "Step 1: Set Shield Fees (Admin Only)"
echo "------------------------------------"
echo "In browser console:"
echo '  window.debugApi.setShieldFees()'
echo "        .then(r => console.log("‚úÖ Result:", r))"
echo "        .catch(e => console.error("‚ùå Error:", e))"
echo ""
echo "Expected: Signature returned, no errors"
echo ""

echo "Step 2: Deposit SOL into Shielded Pool"
echo "--------------------------------------"
echo "Amount: 0.1 SOL"
echo "Expected transaction:"
echo "  - Transfer 1: 0.1 SOL to vault"
echo "  - Transfer 2: 0.25 NOC to fee collector"
echo "  - No other transfers"
echo ""

echo "Step 3: Check Blockchain Explorer"
echo "---------------------------------"
echo "Transaction should show:"
echo "  Transfer 1: From wallet ‚Üí Vault (0.1 SOL)"
echo "  Transfer 2: From wallet ‚Üí Fee collector (0.25 NOC)"
echo ""
echo "Should NOT see:"
echo "  ‚úó 0.00025 SOL/WSOL fee"
echo "  ‚úó 100 NOC transfer"
echo "  ‚úó Any other transfers"
echo ""

echo "Step 4: Transfer Shielded Amount"
echo "-------------------------------"
echo "Amount: 0.05 SOL to recipient address"
echo "Expected:"
echo "  - Split transaction: moves 0.05 SOL in pool"
echo "  - Withdraw transaction: 0.05 SOL to recipient + 0.25 NOC fee"
echo "  - Total recipient receives: 0.05 SOL"
echo "  - You pay: 0.25 NOC fee"
echo ""

echo "Step 5: Verify Recipient"
echo "-----------------------"
echo "Recipient should have:"
echo "  ‚úì 0.05 SOL in transparent wallet (no privacy loss)"
echo "  ‚úó NO access to your shielded notes"
echo "  ‚úó NO information about sender"
echo ""

echo "If Everything Works:"
echo "====================
echo "‚úÖ Fees are correct (0.25 NOC only)"
echo "‚úÖ Privacy is preserved"
echo "‚úÖ SOL transactions use native SOL (not WSOL)"
echo ""

echo "Troubleshooting:"
echo "================"
echo "‚ùå See 0.00025 SOL fee?"
echo "   ‚Üí Call window.debugApi.setShieldFees() to disable percentage fees"
echo ""
echo "‚ùå See 100 NOC transfer for SOL deposit?"
echo "   ‚Üí Old code, rebuild with: npm run build"
echo ""
echo "‚ùå setShieldFees() fails with 'not admin'?"
echo "   ‚Üí You must be the program deployer/admin"
echo "   ‚Üí Only admin can update on-chain fees"
echo ""
